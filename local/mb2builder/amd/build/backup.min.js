/**
 *
 * @package    local_mb2builder
 * @copyright  2018 - 2025 Mariusz Boloz (lmsstyle.com)
 * @license    PHP and HTML: http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later. Other parts: http://themeforest.net/licenses
*/ define(["jquery","core/ajax"],function(a,e){"use strict";let t=a("#mb2-pb-lang"),i=()=>{var t,i;let d=a(".mb2-pb-backup-list"),l=d.attr("data-type"),s=d.attr("data-itemid");(t=l,i=s,e.call([{methodname:"local_mb2builder_get_backup_list",args:{type:t,itemid:i}}])[0]).then(a=>{a.backupitems?d.closest(".backup-table").removeClass("hidden"):d.closest(".backup-table").addClass("hidden"),d.html(a.backupitems)}).catch(a=>{require(["core/log"],function(e){e.debug(a)})})},d=()=>{let d=a=>e.call([{methodname:"local_mb2builder_delete_backup",args:{id:a}}])[0];a(document).on("click",".mb2-pb-delete-backup",function(){let e=a(this).closest(".backup-table").find(".mb2-pb-actions-loading");confirm(t.attr("data-confirmdeletebackup"))&&d(a(this).attr("data-id")).then(a=>{a.deleted&&(e.fadeIn(),i(),setTimeout(function(){e.fadeOut()},700))}).catch(a=>{require(["core/log"],function(e){e.debug(a)})})})},l=()=>{let d=a(".new-backup-form").find("form").attr("id"),l=a(".backup-table .mb2-pb-actions-loading"),s=a=>e.call([{methodname:"local_mb2builder_create_backup",args:{formdata:a}}])[0];a(document).on("click","button.new-backup",function(){a('textarea[name="backup_content"]').val(a("#democontent").val()),a(this).prop("disabled",!0),a(this).text(t.attr("data-processing")),a(this).hasClass("processing")||a("#"+d).submit(),a(this).addClass("processing")}),a("#"+d).on("submit",function(e){e.preventDefault();let d=a(this);s(a(this).serialize()).then(e=>{if(e.backup){d.closest(".new-backup-form").find(".form-message").html(e.backup),l.fadeIn(),i(1),d.find('input[type="text"]').val(""),d.find("textarea").val("");let s=a("button.new-backup");setTimeout(function(){l.fadeOut(),s.prop("disabled",!1),s.text(t.attr("data-create")),s.removeClass("processing")},700),setTimeout(function(){d.closest(".new-backup-form").find(".form-message").html("")},2e4)}}).catch(a=>{require(["core/log"],function(e){e.debug(a)})})})},s=()=>{let i=a(".mb2-pb-uploadbackup-wrap").find("form").attr("id"),d=a=>e.call([{methodname:"local_mb2builder_upload_backup",args:{formdata:a}}])[0];a(document).on("click","button.mb2-pb-upload-backup",function(){let e=a(this);e.prop("disabled",!0),e.text(t.attr("data-processing")),e.hasClass("processing")||a("#"+i).submit(),e.addClass("processing")}),a("#"+i).on("submit",function(e){e.preventDefault();let i=a(this),l=i.closest(".restore-backup").find("button.mb2-pb-upload-backup");d(i.serialize()).then(e=>{let d=a(".mb2-pb-uploadbackup-restore").find("button");a(".restore-backup").find(".file-info").html(e.message),e.isvalid?(d.removeClass("d-none"),d.attr("data-backupfileid",e.backupfileid),d.attr("data-dirname",e.dirname)):d.addClass("d-none");i.find(".filepicker-filename").html(c()),l.prop("disabled",!1),l.removeClass("processing"),l.text(t.attr("data-uploadfile"))}).catch(a=>{require(["core/log"],function(e){e.debug(a)})})})},c=()=>{var a="";return a+='<div class="filepicker-container">',a+='<div class="dndupload-message">You can drag and drop files here to add them. <br>',a+='<div class="dndupload-arrow d-flex"><i class="fa fa-arrow-circle-o-down fa-3x m-auto"></i></div>',a+="</div>",a+="</div>",a+='<div class="dndupload-progressbars"></div>'};return{backupList:i,createBackup:l,deleteBackup:d,uploadBackup:s}});