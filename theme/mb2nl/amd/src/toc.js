/**
 *
 * @package   theme_mb2nl
 * @copyright 2017 - 2025 Mariusz Boloz (lmsstyle.com)
 * @license   PHP and HTML: http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later. Other parts: http://themeforest.net/licenses
*/ define(["jquery","core/ajax","core/notification","theme_mb2nl/str"],function(t,a,e,s){"use strict";let o=t("#page"),i=t(".coursetoc-sectionlist-content"),c=(c=!0)=>{(()=>{let t={courseid:i.attr("data-courseid"),viewhidden:o.attr("data-viewhidden"),start:i.attr("data-start"),limit:i.attr("data-limit")};return a.call([{methodname:"theme_mb2nl_course_enrolment_modules",args:t}])[0]})().then(a=>{i.append(a.sections),a.loadallbtn?(i.attr("data-start",i.attr("data-limit")),i.attr("data-limit",0),t(i.attr("data-container")).append('<button class="coursetoc-loadall btn btn-outline-primary w-100 mt-4" type="button">'+s.get_str("allsections")+"</button>"),t(".coursetoc-loadall").removeClass("loading")):t(".coursetoc-loadall").remove(),c&&n()}).catch(e.exception)},l=()=>{t(document).on("click",".coursetoc-loadall",function(){t(this).addClass("loading"),t(this).prop("disabled",!0),t(this).text(s.get_str("loading")),c(!1)})},r=()=>{(()=>{let t={courseid:i.attr("data-courseid"),modid:o.attr("data-mod_id"),sid:o.attr("data-mod_sid"),ptype:o.attr("data-ptype"),playout:o.attr("data-playout"),viewhidden:o.attr("data-viewhidden")};return a.call([{methodname:"theme_mb2nl_course_modules",args:t}])[0]})().then(t=>{i.append(t.sections);let a=Number(o.attr("data-mod_sid"))?o.attr("data-mod_sid"):o.attr("data-uparam_sid");i.find('[data-sid="'+a+'"]').addClass("active"),i.find('[data-sid="'+a+'"]').closest(".coursetoc-section").addClass("active"),i.find('[data-cmid="'+o.attr("data-mod_id")+'"]').addClass("active"),n(),d()}).catch(e.exception)};var n=function(){t(document).on("click",".coursetoc-section-toggle, .coursetoc-subsection-toggle",function(){var a=t(this).hasClass("coursetoc-subsection-toggle")?t(this).closest(".coursetoc-subsection"):t(this).closest(".coursetoc-section");a.hasClass("active")?(a.removeClass("active"),t(this).attr("aria-expanded","false")):(a.addClass("active"),t(this).attr("aria-expanded","true"))})},d=function(){let a=t(".coursetoc-sectionlist"),e=a.find("li.active"),s=a.find(".coursetoc-section.active");if(!e.length&&!s.length)return null;let o=(e.length?e:s).offset().top+a.scrollTop(),i=t(window).height(),c=Math.ceil(o-i+i/2.7);c>0&&a.scrollTop(c)},u=function(t,a){var e=t.find(".itemname").text();(e=e.toLowerCase()).trim().indexOf(a)>-1||0==a.length?(t.removeClass("hbyjs"),t.addClass("sbyjs")):(t.addClass("hbyjs"),t.removeClass("sbyjs"))},h=function(t,a){t.find(".sbyjs").length||0==a.length?(t.addClass("sbyjs"),t.removeClass("hbyjs")):(t.removeClass("sbyjs"),t.addClass("hbyjs"))};return{courseTocLoad:r,enrolmentTocLoad:c,shortcodeToc:function(){t(".theme-toc").closest(".generalbox").find("h3,h4,h5,h6").each(function(){var a=t(this).html().replace(/[^a-z0-9]/gi,"_");t(this).attr("id",a.trim())})},toggleAll:function(){t(document).on("click",".coursetoc-toggleall",function(){var a=t(this).closest(".coursetoc-tools").length?t(".tgsdb-toc"):t(this).closest(".block_coursetoc"),e=a.find(".coursetoc-section, .coursetoc-subsection"),o=a.find(".coursetoc-section-toggle, .coursetoc-subsection-toggle"),i=!t(this).hasClass("toctool-toggleall");t(this).hasClass("collapsed")?(e.addClass("active"),o.attr("aria-expanded","true"),t(this).attr("aria-expanded","true"),t(this).attr("aria-label",s.get_str("collapseall")),t(this).removeClass("collapsed"),i?t(this).text(s.get_str("collapseall")):t(this).find("i").attr("class","bi bi-chevron-contract")):(e.removeClass("active"),o.attr("aria-expanded","false"),t(this).attr("aria-expanded","false"),t(this).attr("aria-label",s.get_str("expandall")),t(this).addClass("collapsed"),i?t(this).text(s.get_str("expandall")):t(this).find("i").attr("class","bi bi-chevron-expand"))})},searchToc:function(){t(".coursetoc-search form").on("submit",function(t){t.preventDefault()}),t('[name="coursetoc-sinput"').on("keyup",function(){var a=t(this).val().trim().toLowerCase();t(".coursetoc-section").each(function(){var e=t(this);t(this).find(".module-item").each(function(){var e;u(t(this),a)}),h(e,a)})})},loadAll:l,courseTocScroll:d}});