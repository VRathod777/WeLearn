/**
 *
 * @package   theme_mb2nl
 * @copyright 2017 - 2025 Mariusz Boloz (lmsstyle.com)
 * @license   PHP and HTML: http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later. Other parts: http://themeforest.net/licenses
*/ define(["jquery","core/str","core/config","core/fragment","core/templates","theme_mb2nl/actions"],function(t,e,a,n,o,s){"use strict";let i=()=>{let e=0;return t(".modal-section").each(function(){e++}),e},c=e=>{let a=t(".modal-section"),n=t('.modal-section[data-counter="'+e+'"]');n.length&&(d(t(".modal-section.active")),a.removeClass("active"),n.addClass("active"),t(".modal-nav-section-jump").removeClass("active"),t('.modal-nav-section-jump[data-counter="'+e+'"]').addClass("active"),u(n.attr("data-snum")),m(e))},l=e=>{let a=e.find(".lazy");a.length&&a.each(function(){let e=t(this).attr("data-src"),a=t(this).attr("data-bg");e&&t(this).attr("src",e),a&&t(this).css("background-image","url('"+a+"')")})},d=e=>{if(!e.length)return;let a=e.find(".vjs-play-control.vjs-playing");a.length&&a.each(function(){t(this).click()});let n=e.find("iframe");n.length&&n.each(function(){let e=t(this).attr("src");t(this).attr("src",e)})},r=(e,a)=>{let n=t(".modal-section_prev");n.attr("data-counter",e-1),n.prop("disabled",!1);let o=t(".modal-section_next");o.attr("data-counter",e+1),o.prop("disabled",!1),e-1<=0&&n.prop("disabled",!0),e+1>i()&&o.prop("disabled",!0),t(".nav-xof").html(a)},m=t=>{e.get_string("sectionnofn","theme_mb2nl",{num:Number(t),count:i()}).then(function(e){r(Number(t),e)}).catch(t=>{require(["core/log"],function(e){e.debug(t)})})},u=e=>{let i=t(".modal-section#section-"+a.courseId+"_"+e).find(">ul.topics");!i.hasClass("loaded")&&n.loadFragment("theme_mb2nl","course_section",a.courseContextId,{courseid:a.courseId,sectionnum:e}).done((e,a)=>{if(i.html(e),a){let n=t("head").find("script").filter((e,n)=>t(n).html()===a);n.length||o.runTemplateJS(a)}t(".mediaplugin_videojs").length&&require(["media_videojs/loader"],function(t){t.setUp()}),l(i),s.noOverflowCls(),v(),i.addClass("loaded")}).catch(t=>{require(["core/log"],function(e){e.debug(t)})})},h=()=>{let e=t("#modal-nav-sections"),a=t(".toggle-modal-nav-sections");a.removeClass("active"),a.attr("aria-expanded","false"),e.removeClass("active")},g=()=>{t(document).on("click",".mb2modalsection, .modal-section_prev, .modal-section_next, .modal-nav-section-jump",function(){c(t(this).attr("data-counter"))}),t(document).on("click",".toggle-modal-nav-sections",function(){let e=t("#modal-nav-sections");t(this).hasClass("active")?h():(t(this).addClass("active"),t(this).attr("aria-expanded","true"),e.addClass("active"))}),t(".modal").on("click",function(e){t(e.target).closest(".navtool-sections").length||h()}),t("#mb2modalsection").on("hide.bs.modal",function(){let e=t(".modal-section.active");d(e)})},v=()=>{t(".nonamdscripttrigger").length||t("body").append('<button type="button" class="nonamdscripttrigger" style="display:none;"></button>'),t(".nonamdscripttrigger").click()};return{init:g}});