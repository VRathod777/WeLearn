/**
 *
 * @package   theme_mb2nl
 * @copyright 2017 - 2025 Mariusz Boloz (lmsstyle.com)
 * @license   PHP and HTML: http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later. Other parts: http://themeforest.net/licenses
*/ define(["jquery","core/ajax","core/notification"],function(t,e,a){"use strict";let i=t("#page"),r=t("form.theme-course-filter .inner"),n=()=>{(()=>{let t={categoryid:i.attr("data-uparam_categoryid"),tagid:i.attr("data-uparam_tagid"),teacherid:i.attr("data-uparam_teacherid"),cfields:i.attr("data-cfields")};return e.call([{methodname:"theme_mb2nl_course_filters",args:t}])[0]})().then(t=>{r.append(t.filters),$(),s()}).catch(Notification.exception)},c=(a=1,i="")=>{let r=t("form.theme-course-filter"),n=r.find("[disabled]");n.removeAttr("disabled");let c=r.serialize();return n.attr("disabled","disabled"),e.call([{methodname:"theme_mb2nl_course_list",args:{formdata:c,page:a,searchstr:i}}])[0]},s=(t=0)=>{h(!0),t&&m(),c().then(t=>{f(t)}).catch(Notification.exception)};var l,o,d=function(){t(document).on("click",".toggle-list-btn",function(){var e=t(this).closest(".filter-form-field");e.hasClass("active")?(e.removeClass("active"),t(this).attr("aria-expanded","false")):(e.addClass("active"),t(this).attr("aria-expanded","true"))})},f=function(e){setTimeout(function(){t(u().container).empty(),t(u().container).append(e.courses),h(!1)},850)},u=function(){return{container:".courses-container-inner",courselist:".theme-courses-list"}},h=function(e){e?t(u().container).addClass("loading"):t(u().container).removeClass("loading")},m=function(){t("html, body").stop().animate({scrollTop:t(u().container).offset().top-165},650)},p=function(){t(document).on("click",".clearfilters",function(){t(".mb2filter-inpt").each(function(){t(this).prop("checked",!1),"radio"===t(this).attr("type")&&0==t(this).attr("value")&&"filter_price"!==t(this).attr("name")?t(this).prop("checked",!0):"radio"===t(this).attr("type")&&-1==t(this).attr("value")&&"filter_price"===t(this).attr("name")&&t(this).prop("checked",!0)}),t(this).addClass("mb2-hidden"),t(".filter-toggle").find(".criteria-num").remove(),s(1)})},v=function(){t(document).on("click",".filter-toggle",function(){var e=t(".cfilter-wrap");e.hasClass("active")?(e.removeClass("active"),t(this).attr("aria-expanded","false")):(e.addClass("active"),t(this).attr("aria-expanded","true"))}),t(document).on("click",".filter-close",function(){t(".cfilter-wrap").removeClass("active"),t(".filter-toggle").attr("aria-expanded","false")})},g=function(){b(),t(document).on("change",".mb2filter-inpt",function(){b(),s()})},b=function(){let e=t(".filter-toggle"),a=t(".clearfilters");var i=0;let r=(t(".mb2filter-inpt").each(function(){t(this).is(":checked")&&(t(this).val()>0||"filter_price"===t(this).attr("name")&&0==t(this).val())&&i++}),i);0==r?(e.find(".criteria-num").remove(),a.addClass("mb2-hidden")):(e.find(".criteria-num").remove(),e.append('<span class="criteria-num d-inline-flex ml-1 lhsmall fwbold tsizesmall align-items-center">'+r+"</span>"),a.removeClass("mb2-hidden"))},$=function(){g(),d(),v(),p()};return{pagination:function(){t(document).on("click",".theme-courses-paginitem",function(){let e=t(u().courselist),a=t(this).attr("data-page");if(a==e.attr("data-page"))return null;h(!0),m(),c(a).then(t=>{f(t)}).catch(Notification.exception)})},searchCourses:function(){t(document).on("submit",".theme-course-search",function(e){e.preventDefault();var a=t(this).find("input").val().replace(/<\/?[^>]+(>|$)/g,"").toLowerCase();h(!0),m(),c(1,a).then(t=>{f(t)}).catch(Notification.exception)})},coursesFilters:n}});